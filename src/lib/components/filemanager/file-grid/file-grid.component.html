<!-- <div>
    <input type="file" id="fileElem" multiple accept="image/*" onchange="handleFiles(this.files)">
</div> -->

<div
    style="display: contents"
    [style.--filemanager-fileicon-backdrop]="'url(' + iconResolver.path + '/pop/generic.svg)'"
    (dragstart)="userIsDraggingFile = true"
    (dragend)="userIsDraggingFile = false"
    (dragover)="draggingOver = true"
    (dragleave)="draggingOver = false"
    (ondrop)="onDrop($event)"
>
    <!-- <ng-container *ngIf="draggingOver"></ng-container> -->
    <!-- Grid mode -->
    <ng-scrollbar
        *ngIf="viewMode == 'grid'"
        class="grid {{gridSize}} {{config.imageSize || 'normal'}}"
        [class.selectionMode]="config.mode == 'focusFiles'"
        [class.showDropArea]="draggingOver"
        style="height: 100%; width: 100%"
        track="vertical"
        pointerEventsMethod="scrollbar"
        [ngx-ctx-menu]="folderContextMenu"
    >
        <div class="resize-observer" #fileViewport></div>
        <cdk-virtual-scroll-viewport
            itemSize="134"
            scrollViewport
            (click)="selection = []; selectionText = ''"
        >
            <div class="row" *cdkVirtualFor="let row of sortedFolders">
                <div class="file"
                    *ngFor="let item of row"
                    [class.selected]="selection.includes(item)"
                    [class.generic]="item['_icon'].needsBackdrop"
                    [ngx-ctx-menu]="fileContextMenu"
                    [ngx-ctx-menu-context]="item"
                >
                    <mat-checkbox
                        #checkbox
                        *ngIf="config.mode == 'focusFiles' && item.kind == 'file'"
                        [checked]="item['_value']"
                        (change)="onToggle(item, $event)"
                    />
                    <div
                        style="display: contents"
                        (click)="onSelect(item, $event)"
                        (dblclick)="onItemClick(item)"
                        (dragstart)="onDragStart($event, item)"
                    >
                        <img [src]="item['_icon'].path"/>
                        <p>{{item.name}}</p>
                    </div>
                </div>
            </div>
        </cdk-virtual-scroll-viewport>
    </ng-scrollbar>

    <!-- List mode -->
    <div
        *ngIf="viewMode == 'list'"
        [class.showDropArea]="draggingOver"
        style="width: 100%; height: 100%"
    >
        <app-tabulator
            [dataSource]="directoryContents"
            [columns]="[
                { field: 'name', title: 'Name', formatter: nameCellFormatter },
                { field: '_size', title: 'Size' },
                { field: '_ctime', title: 'Created' },
                { field: '_mtime', title: 'Modified' },
            ]"
            [options]="{
                rowHeight: 32
            }"
            (rowClick)="onRowClick($event)"
            (rowDblClick)="onItemClick($event.data)"
            (rowContext)="onRowCtx($event)"
        />

        <!-- <div style="display: flex; height: 32px; align-items: center">
            <div style="flex: 1; padding-left: 8px">Name</div>
            <div style="width: 100px">Size</div>
            <div style="width: 120px">Created</div>
            <div style="width: 120px">Modified</div>
        </div>
        <ng-scrollbar
            class="list"
            style="height: calc(100% - 32px); width: 100%"
            track="vertical"
            pointerEventsMethod="scrollbar"
            [ngx-ctx-menu]="folderContextMenu"
        >
            <div class="resize-observer" #fileViewport></div>
            <cdk-virtual-scroll-viewport
                itemSize="42"
                scrollViewport
                (click)="selection = []; selectionText = ''"
            >
                <div
                    *cdkVirtualFor="let item of directoryContents; let i = index"
                    class="row"
                    [class.odd]="i%2==1"
                    [class.selected]="selection.includes(item)"
                    [ngx-ctx-menu]="fileContextMenu"
                    [ngx-ctx-menu-context]="item"

                    (click)="onSelect(item, $event)"
                    (dblclick)="onItemClick(item)"
                    (dragstart)="onDragStart($event, item)"
                >
                    <div style="flex: 1; display: flex; align-items: center;">
                        <mat-checkbox
                            #checkbox
                            *ngIf="config.mode == 'focusFiles' && item.kind == 'file'"
                            [checked]="item['_value']"
                            (change)="onToggle(item, $event)"
                        />

                        <img style="height: 24px; margin-right: 6px" [src]="item['_icon'].path"/>
                        <p>{{item.name}}</p>
                    </div>

                    <div style="width: 100px">{{item.stats?.size ? bytesToString(item.stats.size) : ''}}</div>

                    <div style="width: 120px">{{item._ctime | date}}</div>
                    <div style="width: 120px">{{item._mtime | date}}</div>
                </div>
            </cdk-virtual-scroll-viewport>
        </ng-scrollbar> -->
    </div>
</div>

<div class="select-hint" *ngIf="selectionText">
    {{selectionText}}
</div>
